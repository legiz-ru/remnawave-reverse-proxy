---
title: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus –∏ Grafana
description: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Grafana –∏ Prometheus
---

import { Steps } from '@astrojs/starlight/components';
import { LinkButton } from '@astrojs/starlight/components';

–ê–≤—Ç–æ—Ä: **[OMchik33](../../contribution/resources#omchik33)**  
–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞–Ω–µ–ª–∏ [Remnawave](https://remna.st) —Å –ø–æ–º–æ—â—å—é Prometheus, Grafana –∏ Node Exporter, –∞ —Ç–∞–∫–∂–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç—Ä–∏–∫–∞–º —á–µ—Ä–µ–∑ SSH-—Ç—É–Ω–Ω–µ–ª—å –∏ Nginx.

:::danger[–í–∞–∂–Ω–æ]
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ __–æ—Ç–¥–µ–ª—å–Ω—ã–π__ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤—ã–π VPS —Å–µ—Ä–≤–µ—Ä. –û–ø–∏—Å–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç –¥–µ–π—Å—Ç–≤–∏–π –∏–∑-–ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root
:::

## üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `docker-compose.yml` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Remnawave

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `docker-compose.yml` Remnawave –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç `3001`, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–¥–∞—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏:

```yaml
ports:
  - '127.0.0.1:3001:3001'
```

<details>
  <summary>–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–≤–∞—Ä–∏–∞–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ —Å–∫—Ä–∏–ø—Ç—É eGames)</summary>

```yaml
remnawave:
  image: remnawave/backend:latest
  container_name: remnawave
  hostname: remnawave
  restart: always
  env_file:
    - .env
  ports:
    - '127.0.0.1:3000:3000'
    - '127.0.0.1:3001:3001'
  networks:
    - remnawave-network
  depends_on:
    remnawave-db:
      condition: service_healthy
    remnawave-redis:
      condition: service_healthy
  logging:
    driver: 'json-file'
    options:
      max-size: '30m'
      max-file: '5'
```

</details>

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH-—Ç—É–Ω–Ω–µ–ª—è

:::note
–¢—É–Ω–Ω–µ–ª—å –Ω—É–∂–µ–Ω –µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ –∫—É–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Remnawave –ø–æ —Å–∫—Ä–∏–ø—Ç—É eGames
:::

:::caution
–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
:::

<Steps>

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞, –ø–∞—Ä–æ–ª—å –Ω–µ –∑–∞–¥–∞–µ–º:

    ```bash
    ssh-keygen -t ed25519 -f ~/.ssh/remna_tunnel_key
    ```

2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Remnawave, –≤ —Ñ–∞–π–ª `~/.ssh/authorized_keys`. –í–º–µ—Å—Ç–æ `AAAAC3...` –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `remna_tunnel_key.pub`, –Ω–∞—á–∏–Ω–∞—é—â–µ–µ—Å—è –Ω–∞ `AAAAC3`:

    ```bash
    from="IP_–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–≥–æ_—Å–µ—Ä–≤–µ—Ä–∞",no-pty,no-agent-forwarding,no-X11-forwarding,command="/bin/false" ssh-ed25519 AAAAC3... remna_tunnel_key
    ```

3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `autossh` (–ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ):

    ```bash
    sudo apt install autossh
    ```

4. –°–æ–∑–¥–∞–Ω–∏–µ systemd-—Å–µ—Ä–≤–∏—Å–∞ `/etc/systemd/system/remna-tunnel.service`. –ó–∞–º–µ–Ω–∏—Ç–µ `remnauser@REMNA_SERVER_IP`, —ç—Ç–æ ssh –ª–æ–≥–∏–Ω –∏ –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–∞–Ω–µ–ª–∏ Remnawave.

    ```ini
    [Unit]
    Description=SSH tunnel to Remnawave for Prometheus and Node Exporter
    After=network.target

    [Service]
    User=root
    Environment="AUTOSSH_GATETIME=0"
    ExecStart=/usr/bin/autossh -N \
    -o "ServerAliveInterval 60" \
    -o "ServerAliveCountMax 3" \
    -i /root/.ssh/remna_tunnel_key \
    -L 9001:localhost:3001 \
    -L 9002:localhost:9100 \
    remnauser@REMNA_SERVER_IP
    Restart=always

    [Install]
    WantedBy=multi-user.target
    ```

5. –ù–∞ –ø–µ—Ä–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–≥–¥–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è autossh) –≤–∞–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –≤—Ç–æ—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –≤ known_hosts, –≥–¥–µ 12.345.678.91 - IP –∞–¥—Ä–µ—Å –ø–∞–Ω–µ–ª–∏ Remnawave, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–∞, –∏–Ω–∞—á–µ —Å–ª—É–∂–±–∞ –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —Å –ø–∞–Ω–µ–ª—å—é.

    ```bash
    ssh-keyscan -H 12.345.678.91 >> ~/.ssh/known_hosts
    ```

6. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:

    ```bash
    sudo systemctl daemon-reexec
    sudo systemctl enable remna-tunnel
    sudo systemctl start remna-tunnel
    ```

7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞:

    ```bash
    sudo systemctl status remna-tunnel
    ```

</Steps>

–¢–µ–ø–µ—Ä—å –º–µ—Ç—Ä–∏–∫–∏ Remnawave –∏ Node Exporter –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ `http://localhost:9001/metrics` –∏ `http://localhost:9002/metrics` –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

## üìà –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus –∏ Grafana

<Steps>

1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:

    ```bash
    mkdir -p /opt/monitoring/{grafana,prometheus}
    ```

2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª `/opt/monitoring/docker-compose.yml`
  
    ```yaml
    services:
      prometheus:
        image: prom/prometheus:latest
        container_name: prometheus
        restart: unless-stopped
        volumes:
          - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
          - prometheus-data:/prometheus
        command:
          - '--config.file=/etc/prometheus/prometheus.yml'
          - '--storage.tsdb.path=/prometheus'
          - '--web.console.libraries=/etc/prometheus/console_libraries'
          - '--web.console.templates=/etc/prometheus/consoles'
          - '--web.external-url=https://sub.mydomain.com/prometheus/'
          - '--web.route-prefix=/'
        network_mode: host

      grafana:
        image: grafana/grafana:latest
        container_name: grafana
        restart: unless-stopped
        volumes:
          - grafana-data:/var/lib/grafana
          - ./grafana/provisioning:/etc/grafana/provisioning
        environment:
          - GF_SERVER_DOMAIN=mydomain.com
          - GF_SERVER_ROOT_URL=https://sub.mydomain.com/grafana
          - GF_SERVER_SERVE_FROM_SUB_PATH=true
          - GF_SERVER_HTTP_PORT=3000
          - GF_SERVER_PROTOCOL=http
          - GF_SECURITY_ADMIN_USER=admin
          - GF_SECURITY_ADMIN_PASSWORD=admin
          - GF_ANALYTICS_REPORTING_ENABLED=false
        network_mode: host
        
      xray-checker:
        image: kutovoys/xray-checker
        environment:
          - "SUBSCRIPTION_URL=https://podpiska.mydomain.com/6f5g46df46g45f54"
          - "PROXY_STATUS_CHECK_URL=http://google.com/generate_204"
          - "PROXY_CHECK_INTERVAL=60"
        network_mode: host

    volumes:
      prometheus-data:
      grafana-data:
    ```

</Steps>

–ó–¥–µ—Å—å `sub.mydomain.com` - –∞–¥—Ä–µ—Å –¥–æ–º–µ–Ω–∞, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–º—É VPS, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è Grafana –∏ Prometheus

`https://podpiska.mydomain.com/6f5g46df46g45f54` - –ø–æ–¥–ø–∏—Å–∫–∞, —Å–¥–µ–ª–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus

<Steps>

1. –§–∞–π–ª `/opt/monitoring/prometheus/prometheus.yml`. `username` –∏ `password` –∏–∑ `.env` —Ñ–∞–π–ª–∞ Remnawave (—Å–µ–∫—Ü–∏—è `### PROMETHEUS ###`)

  ```yaml
    global:
      scrape_interval: 15s

    scrape_configs:
      # –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Grafana-–¥–∞—à–±–æ—Ä–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ —Å—Å—ã–ª–∫–∞—Ö –Ω–∏–∂–µ
      # –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ job_name: integrations/node_exporter.
      - job_name: 'node_exporter' 
        static_configs:
          - targets: ['127.0.0.1:9002']
            labels:
              cluster: "test"
              instance: "127.0.0.1:9002"
      - job_name: 'remnawave_exporter'
        static_configs:
          - targets: ['127.0.0.1:9001']
        basic_auth:
          username: "XXXXXXXXXXXXXXX"
          password: "XXXXXXXXXXXXXXX"
      - job_name: "xray-checker"
        metrics_path: "/metrics"
        static_configs:
          - targets: ["localhost:2112"]
        scrape_interval: 1m
    ```

2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

    ```bash
    cd /opt/monitoring && docker compose up -d
    ```

</Steps>

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∏ SSL

<Steps>

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx (–ª–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞, –Ω–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Docker):

    ```bash
    apt install nginx
    ```

2. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, –¥–æ–º–µ–Ω 3 —É—Ä–æ–≤–Ω—è —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ IP –∞–¥—Ä–µ—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

    ```bash
    sudo apt install certbot python3-certbot-nginx
    sudo certbot --nginx -d sub.mydomain.com
    ```

3. –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ crontab:

    ```bash
    0 5 * * * root certbot renew --quiet
    ```

4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ nginx

    ```bash
    nano /etc/nginx/sites-available/default
    ```

</Steps>

<details>
  <summary>–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx</summary>

```
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ cookie
map $http_cookie $auth_cookie {
    default 0;
    "~*fd4gd54fg2dfg4241=1" 1;
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ GET-–ø–∞—Ä–∞–º–µ—Ç—Ä—É
map $arg_fd4gd54fg2dfg4241 $auth_query {
    default 0;
    "1" 1;
}

# –û–±—â–∏–π —Ñ–ª–∞–≥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
map "$auth_cookie$auth_query" $authorized {
    "~1" 1;
    default 0;
}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—É–∫–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
map $arg_fd4gd54fg2dfg4241 $set_cookie_header {
    "1" "fd4gd54fg2dfg4241=1; Path=/; HttpOnly; Secure; SameSite=Strict; Max-Age=31536000";
    default "";
}

# HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
server {
    listen 80;
    server_name sub.mydomain.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS —Å–µ—Ä–≤–µ—Ä –±–ª–æ–∫
server {
    listen 443 ssl http2;
    server_name sub.mydomain.com;
    
    # SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ssl_certificate /etc/letsencrypt/live/sub.mydomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/sub.mydomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É–∫—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ
    add_header Set-Cookie $set_cookie_header;

    # –†–µ–¥–∏—Ä–µ–∫—Ç —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ —Å—Ä–∞–∑—É –Ω–∞ –Ω—É–∂–Ω—ã–π –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–∞—à–±–æ–∞—Ä–¥ –≤ –ì—Ä–∞—Ñ–∞–Ω–µ
    location = / {
        return 301 /grafana/public-dashboards/f5g4df4g5df4gd5f4g63d4834379e;
    }

    # Grafana –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    location /grafana {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $server_name;
        
        # WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;

        # –£–±–∏—Ä–∞–µ–º Authorization header
        proxy_set_header Authorization "";
    }

    # Grafana Live WebSocket
    location /grafana/api/live/ {
        proxy_pass http://localhost:3000/api/live/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Prometheus
    location /prometheus/ {
        if ($authorized = 0) {
            return 404;
        }

        proxy_pass http://localhost:9090/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header Authorization "";
    }

    # Xray Checker
    location /checker/ {
        if ($authorized = 0) {
            return 404;
        }

        proxy_pass http://localhost:2112/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $server_name;
    }
}
```

–ó–¥–µ—Å—å `sub.mydomain.com` - –∞–¥—Ä–µ—Å –¥–æ–º–µ–Ω–∞, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É VPS, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ì—Ä–∞—Ñ–∞–Ω–∞ –∏ –ü—Ä–æ–º–µ—Ç–µ–π

`fd4gd54fg2dfg4241` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∫—É–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–µ, –ù–£–ñ–ù–û –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–µ

`/grafana/public-dashboards/f5g4df4g5df4gd5f4g63d4834379e;` - —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π Dashboard –≤ Grafana. –í—ã –ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ –Ω—É–∂–Ω–æ–≥–æ Dashboard. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –≤—Å—Ç–∞–≤–∏—Ç—å —Å—é–¥–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx. –°—Å—ã–ª–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ nginx –∑–∞–¥–∞–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –¥–æ–º–µ–Ω—É sub.mydomain.com —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –Ω–∞ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π Dashboard
</details>

<Steps>

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `/etc/nginx/nginx.conf`, –¥–æ–±–∞–≤–ª—è–µ–º —Ç—É–¥–∞:

    ```
            # –ö–∞—Ä—Ç–∞ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π Grafana
            map $http_upgrade $connection_upgrade {
            default upgrade;
            '' close;
            }
    ```

2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

    ```
    nginx -t && systemctl restart nginx
    ```

</Steps>

–ü—Ä–∏–º–µ—Ä –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ `nginx.conf` —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω—É–∂–Ω–æ–π `map`

<details>
  <summary>–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–º–µ—Ä</summary>

```
user www-data;
worker_processes auto;
pid /run/nginx.pid;
error_log /var/log/nginx/error.log;
include /etc/nginx/modules-enabled/*.conf;

events {
        worker_connections 768;
        # multi_accept on;
}

http {

        ##
        # Basic Settings
        ##

        sendfile on;
        tcp_nopush on;
        types_hash_max_size 2048;
        # server_tokens off;

        # server_names_hash_bucket_size 64;
        # server_name_in_redirect off;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        # –ö–∞—Ä—Ç–∞ –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π Grafana
        map $http_upgrade $connection_upgrade {
        default upgrade;
        '' close;
        }
        ##
        # SSL Settings
        ##

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;

        ##
        # Logging Settings
        ##

        access_log /var/log/nginx/access.log;

        ##
        # Gzip Settings
        ##

        gzip on;

        # gzip_vary on;
        # gzip_proxied any;
        # gzip_comp_level 6;
        # gzip_buffers 16 8k;
        # gzip_http_version 1.1;
        # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/jav>

        ##
        # Virtual Host Configs
        ##

        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}
```

</details>

## üß† Node Exporter

<Steps>

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å Remnawave:

    ```bash
    . <(wget -qO- https://raw.githubusercontent.com/g7AzaZLO/NodeExporter-autoinstaller/main/NodeExporter-auto-install.sh)
    ```

2. –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ –Ω–æ–¥—ã –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `prometheus.yml`:

    ```yaml
    - job_name: 'external_nodes'
      static_configs:
        - targets: ['1.2.3.4:9100']
    ```

</Steps>

Node Exporter –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–æ `localhost:9002` (—á–µ—Ä–µ–∑ SSH-—Ç—É–Ω–Ω–µ–ª—å).

–ó–¥–µ—Å—å `1.2.3.4` - –∞–¥—Ä–µ—Å –æ—á–µ—Ä–µ–¥–Ω–æ–π –Ω–æ–¥—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –º—ã —Ç–∞–∫–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ Node Exporter

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH-—Ç—É–Ω–Ω–µ–ª–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –¥–∞–Ω–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π.

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∫–∞—Ü–∏—è –≤ Grafana

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ: `https://sub.mydomain.com/grafana`
- –í—Ö–æ–¥: `admin / admin`, –∑–∞—Ç–µ–º —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å
- –î–æ–±–∞–≤—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: **Prometheus**
  - URL: `http://localhost:9090`
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Explore ‚Üí Metrics ‚Üí Grafana Drilldown ‚Üí Metrics**

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤ Grafana –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö - Prometheus. –¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Dashboard, –¥–æ–±–∞–≤–ª—è—è –≤ –Ω–µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–∫–ª—é—á–∞—è –∫ –Ω–∏–º –Ω—É–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Prometheus

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–º–µ—Ç—Ä–∏–∫) –≤ Prometheus

<Steps>

1. –ó–∞–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ `https://sub.mydomain.com/prometheus/graph?fd4gd54fg2dfg4241=1`

2. –û—Ç–∫—Ä–æ–π—Ç–µ –º–µ–Ω—é `Status` - `Target Health` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞–ø—Ä–æ—Ç–∏–≤ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–æ–∏—Ç `UP`.

3. –û—Ç–∫—Ä—ã—Ç—å Prometheus `https://sub.mydomain.com/prometheus/graph?fd4gd54fg2dfg4241=1`

4. –û—Ç–∫—Ä—ã—Ç—å Grafana `https://sub.mydomain.com/grafana/`

5. –û—Ç–∫—Ä—ã—Ç—å xray checker `https://sub.mydomain.com/checker/?fd4gd54fg2dfg4241=1`

</Steps>

:::note
–ï—Å–ª–∏ –º–µ–Ω—è–ª–∏ –∫–æ–¥ –∫—É–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `nginx`, —Ç–æ–≥–¥–∞ –∏ –≤ —Å—Å—ã–ª–∫–∞—Ö –≤—ã—à–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –µ–≥–æ –∏–∑–º–µ–Ω–∏—Ç—å
:::

:::tip[–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è]
–ú–æ–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –ø—Ä–∏–º–µ—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ node exporter  
- Dashboard ID: `1860`
- [https://grafana.com/grafana/dashboards/1860](https://grafana.com/grafana/dashboards/1860)
:::

## üìô –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫–æ–≤](https://t.me/c/2409638119/3118)
